(self.webpackChunk=self.webpackChunk||[]).push([[5717],{35717:function(e,t){var r=.01;"function"==typeof SubtitlesOctopusOnLoad&&SubtitlesOctopusOnLoad(),e.exports&&(e.exports=function(e){var t=!1;try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));e instanceof WebAssembly.Module&&(t=new WebAssembly.Instance(e)instanceof WebAssembly.Instance)}}catch(e){}console.log("WebAssembly support detected: "+(t?"yes":"no"));var n,a,s=this;function o(){s.setCurrentTime(s.video.currentTime+s.timeOffset)}function i(){s.setIsPaused(!1,s.video.currentTime+s.timeOffset)}function d(){s.setIsPaused(!0,s.video.currentTime+s.timeOffset)}function v(){s.video.removeEventListener("timeupdate",o,!1)}function c(){s.video.addEventListener("timeupdate",o,!1);var e=s.video.currentTime+s.timeOffset;s.setCurrentTime(e),s.renderAhead>0&&u(e,!0)}function m(){s.setRate(s.video.playbackRate)}function h(){s.setIsPaused(!0,s.video.currentTime+s.timeOffset)}function l(e){e.target.removeEventListener(e.type,l,!1),s.resize()}function u(e,t){for(var r=[],n=0,a=s.renderedItems.length;n<a;n++)((v=s.renderedItems[n]).emptyFinish<0||e<v.emptyFinish)&&r.push(v);if(t&&r.length>0&&e<r[0].eventStart)if(r[0].eventStart-e>60)console.info("seeked back too far, cleaning prerender buffer"),r=[];else{console.info("seeked backwards, need to free up some buffer");var o=0,i=.3*s.renderAhead,d=[];for(n=0,a=r.length;n<a;n++){var v;if((o+=(v=r[n]).size)>=i||v.emptyFinish<0)break;d.push(v)}r=d}t&&(s.oneshotState.displayedEvent=null,s.oneshotState.nextRequestOffset=0);var c=r.length<s.renderedItems.length;return s.renderedItems=r,c}function f(e,t){if(s.renderAhead&&!(s.renderAhead<=0)&&(!s.oneshotState.renderRequested||t)){if(void 0===e){if(!s.video)return;e=s.video.currentTime+s.timeOffset}for(var r=0,n=0,a=s.renderedItems.length;n<a;n++){var o=s.renderedItems[n];if(o.emptyFinish<0)return void console.info("oneshot already reached end-of-events");if(e>=o.eventStart&&e<o.emptyFinish)return void console.debug("not requesting a render for "+e+" as event already covering it exists (start="+o.eventStart+", empty="+o.emptyFinish+")");r+=o.size}if(r<=s.renderAhead){var i=e-(t?0:.001);s.oneshotState.renderRequested?(s.workerActive&&console.info("worker busy, requesting to seek"),s.oneshotState.requestNextTimestamp=i):(s.oneshotState.renderRequested=!0,s.worker.postMessage({target:"oneshot-render",lastRendered:i,renderNow:t,iteration:s.oneshotState.iteration}))}}}function p(e,t){s.oneshotState.displayedEvent=e;var r=e.eventFinish!==e.emptyFinish&&e.eventFinish<=t;if(s.oneshotState.eventStart!=e.eventStart||s.oneshotState.eventOver!=r){s.oneshotState.eventStart=e.eventStart,s.oneshotState.eventOver=r,s.oneshotState.nextRequestOffset=.5*(s.oneshotState.nextRequestOffset+.001*e.spentTime),s.oneshotState.nextRequestOffset=Math.min(s.oneshotState.nextRequestOffset,1);var n=performance.now();if(e.viewport.width==s.canvas.width&&e.viewport.height==s.canvas.height||(s.canvas.width=e.viewport.width,s.canvas.height=e.viewport.height),s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height),!r)for(var a=0;a<e.items.length;a++){var o=e.items[a];s.bufferCanvas.width=o.w,s.bufferCanvas.height=o.h,s.bufferCanvasCtx.putImageData(o.image,0,0),s.ctx.drawImage(s.bufferCanvas,o.x,o.y)}if(s.debug){var i=Math.round(performance.now()-n);console.log("render: "+Math.round(e.spentTime-e.blendTime)+" ms, blend: "+Math.round(e.blendTime)+" ms, draw: "+i+" ms")}}}function g(){if(s.rafId=window.requestAnimationFrame(g),s.video){for(var e=s.video.currentTime+s.timeOffset,t=null,n=0,a=s.renderedItems.length;n<a&&(c=s.renderedItems[n]).eventStart<=e;n++)t=c;t?p(t,e):s.oneshotState.displayedEvent&&p(s.oneshotState.displayedEvent,e);var o=e;s.video.paused||(o+=Math.max(s.oneshotState.nextRequestOffset,1/s.targetFps)*s.video.playbackRate);var i=null,d=-1,v=!1;for(n=0,a=s.renderedItems.length;n<a;n++){var c;if((c=s.renderedItems[n]).eventStart<=o)i=c,d=c.emptyFinish;else{if(!(d>=0))break;if(!(c.eventStart-d<r))break;d=c.emptyFinish,v=c.animated}}i&&(o=d>=0?Math.max(d,o):-1),(!s.video.paused&&u(e)||!t||s.oneshotState.restart)&&o>=0&&Math.abs(s.oneshotState.requestNextTimestamp-o)>r&&f(o,o!==d||v),s.oneshotState.restart=!1}}function w(){var e=s.renderFramesData,t=performance.now();s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height);for(var r=0;r<e.canvases.length;r++){var n=e.canvases[r];s.bufferCanvas.width=n.w,s.bufferCanvas.height=n.h;var a=new Uint8ClampedArray(n.buffer);if(s.hasAlphaBug)for(var o=3;o<a.length;o+=4)a[o]=a[o]>=1?a[o]:1;var i=new ImageData(a,n.w,n.h);s.bufferCanvasCtx.putImageData(i,0,0),s.ctx.drawImage(s.bufferCanvas,n.x,n.y)}if(s.debug){var d=Math.round(performance.now()-t),v=e.blendTime;void 0!==v?console.log("render: "+Math.round(e.spentTime-v)+" ms, blend: "+Math.round(v)+" ms, draw: "+d+" ms; TOTAL="+Math.round(e.spentTime+d)+" ms"):console.log(Math.round(e.spentTime)+" ms (+ "+d+" ms draw)"),s.renderStart=performance.now()}}function b(){var e=s.renderFramesData,t=performance.now();s.ctx.clearRect(0,0,s.canvas.width,s.canvas.height);for(var r=0;r<e.bitmaps.length;r++){var n=e.bitmaps[r];s.ctx.drawImage(n.bitmap,n.x,n.y)}if(s.debug){var a=Math.round(performance.now()-t);console.log(e.bitmaps.length+" bitmaps, libass: "+Math.round(e.libassTime)+"ms, decode: "+Math.round(e.decodeTime)+"ms, draw: "+a+"ms"),s.renderStart=performance.now()}}s.canvas=e.canvas,s.renderMode=e.renderMode||(e.lossyRender?"lossy":"wasm-blend"),s.dropAllAnimations=e.dropAllAnimations||!1,s.libassMemoryLimit=e.libassMemoryLimit||0,s.libassGlyphLimit=e.libassGlyphLimit||0,s.targetFps=e.targetFps||24,s.prescaleFactor=e.prescaleFactor||1,s.prescaleHeightLimit=e.prescaleHeightLimit||1080,s.maxRenderHeight=e.maxRenderHeight||0,s.resizeVariation=e.resizeVariation||.2,s.renderAhead=e.renderAhead||0,s.isOurCanvas=!1,s.video=e.video,s.canvasParent=null,s.fonts=e.fonts||[],s.availableFonts=e.availableFonts||[],s.onReadyEvent=e.onReady,s.workerUrl=t?e.workerUrl||"subtitles-octopus-worker.js":e.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",s.subUrl=e.subUrl,s.subContent=e.subContent||null,s.onErrorEvent=e.onError,s.debug=e.debug||!1,s.lastRenderTime=0,s.pixelRatio=window.devicePixelRatio||1,s.timeOffset=e.timeOffset||0,s.renderedItems=[],s.renderAhead=1024*s.renderAhead*1024*.9,s.oneshotState={displayedEvent:null,eventStart:null,eventOver:!1,iteration:0,renderRequested:!1,requestNextTimestamp:-1,nextRequestOffset:0,restart:!0,prevWidth:null,prevHeight:null},s.rafId=0,s.hasAlphaBug=!1,function(){if("function"==typeof ImageData.prototype.constructor)try{return void new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(e){console.log("detected that ImageData is not constructable despite browser saying so")}var e=document.createElement("canvas").getContext("2d");window.ImageData=function(){var t=0;if(arguments[0]instanceof Uint8ClampedArray)var r=arguments[t++];var n=arguments[t++],a=arguments[t],s=e.createImageData(n,a);return r&&s.data.set(r),s}}(),s.workerError=function(e){if(console.error("Worker error: ",e),s.onErrorEvent&&s.onErrorEvent(e),!s.debug)throw s.dispose(),new Error("Worker error: "+e)},s.init=function(){window.Worker?(s.worker||(s.worker=new Worker(s.workerUrl),s.worker.addEventListener("message",s.onWorkerMessage),s.worker.addEventListener("error",s.workerError)),s.workerActive=!1,s.createCanvas(),s.setVideo(e.video),s.setSubUrl(e.subUrl),n=s.canvas.width,a=s.canvas.height,s.worker.postMessage({target:"worker-init",width:s.canvas.width,height:s.canvas.height,URL:document.URL,currentScript:s.workerUrl,preMain:!0,renderMode:s.renderMode,subUrl:s.subUrl,subContent:s.subContent,fonts:s.fonts,availableFonts:s.availableFonts,debug:s.debug,targetFps:s.targetFps,libassMemoryLimit:s.libassMemoryLimit,libassGlyphLimit:s.libassGlyphLimit,renderOnDemand:s.renderAhead>0,dropAllAnimations:s.dropAllAnimations})):s.workerError("worker not supported")},s.createCanvas=function(){s.canvas||(s.video?(s.isOurCanvas=!0,s.canvas=document.createElement("canvas"),s.canvas.className="libassjs-canvas",s.canvas.style.display="none",s.canvasParent=document.createElement("div"),s.canvasParent.className="libassjs-canvas-parent",s.canvasParent.appendChild(s.canvas),s.video.nextSibling?s.video.parentNode.insertBefore(s.canvasParent,s.video.nextSibling):s.video.parentNode.appendChild(s.canvasParent)):s.canvas||s.workerError("Don't know where to render: you should give video or canvas in options.")),s.ctx=s.canvas.getContext("2d"),s.bufferCanvas=document.createElement("canvas"),s.bufferCanvasCtx=s.bufferCanvas.getContext("2d"),s.bufferCanvas.width=1,s.bufferCanvas.height=1;var e=new Uint8ClampedArray([0,255,0,0]),t=new ImageData(e,1,1);s.bufferCanvasCtx.clearRect(0,0,1,1),s.ctx.clearRect(0,0,1,1);var r=s.ctx.getImageData(0,0,1,1).data;s.bufferCanvasCtx.putImageData(t,0,0),s.ctx.drawImage(s.bufferCanvas,0,0);var n=s.ctx.getImageData(0,0,1,1).data;s.hasAlphaBug=r[1]!=n[1],s.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")},s.setVideo=function(e){s.video=e,s.video&&(s.video.addEventListener("timeupdate",o,!1),s.video.addEventListener("playing",i,!1),s.video.addEventListener("pause",d,!1),s.video.addEventListener("seeking",v,!1),s.video.addEventListener("seeked",c,!1),s.video.addEventListener("ratechange",m,!1),s.video.addEventListener("waiting",h,!1),document.addEventListener("fullscreenchange",s.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",s.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",s.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",s.resizeWithTimeout,!1),window.addEventListener("resize",s.resizeWithTimeout,!1),"undefined"!=typeof ResizeObserver&&(s.ro=new ResizeObserver(s.resizeWithTimeout),s.ro.observe(s.video)),s.video.videoWidth>0?s.resize():s.video.addEventListener("loadedmetadata",l,!1))},s.getVideoPosition=function(){var e=s.video.videoWidth/s.video.videoHeight,t=s.video.offsetWidth,r=s.video.offsetHeight,n=t,a=r;return t/r>e?n=Math.floor(r*e):a=Math.floor(t/e),{width:n,height:a,x:(t-n)/2,y:(r-a)/2}},s.setSubUrl=function(e){s.subUrl=e},s.resetRenderAheadCache=function(e){if(s.renderAhead>0){var t=[];if(e&&s.oneshotState.prevHeight&&s.oneshotState.prevWidth){if(s.oneshotState.prevHeight===a&&s.oneshotState.prevWidth===n)return;var r=10,o=.3*s.renderAhead;a>=s.oneshotState.prevHeight*(1-s.resizeVariation)&&a<=s.oneshotState.prevHeight*(1+s.resizeVariation)&&n>=s.oneshotState.prevWidth*(1-s.resizeVariation)&&n<=s.oneshotState.prevWidth*(1+s.resizeVariation)&&(console.debug("viewport changes are small, leaving more of prerendered buffer"),r=30,o=.5*s.renderAhead);for(var i=s.video.currentTime+s.timeOffset+r,d=0,v=0;v<s.renderedItems.length;v++){var c=s.renderedItems[v];if(c.emptyFinish<0||i<c.emptyFinish)break;if((d+=c.size)>=o)break;t.push(c)}}console.info("resetting prerender cache"),s.renderedItems=t,s.oneshotState.eventStart=null,s.oneshotState.iteration++,s.oneshotState.renderRequested=!1,s.oneshotState.prevHeight=a,s.oneshotState.prevWidth=n,s.oneshotState.nextRequestOffset=0,s.oneshotState.restart=!0,e||(s.oneshotState.displayedEvent=null),s.rafId||(s.rafId=window.requestAnimationFrame(g)),f(void 0,!0)}},s.renderFrameData=null,s.workerActive=!1,s.frameId=0,s.onWorkerMessage=function(e){s.workerActive||(s.workerActive=!0,s.onReadyEvent&&s.onReadyEvent());var t=e.data;switch(t.target){case"stdout":console.log(t.content);break;case"console-log":console.log.apply(console,JSON.parse(t.content));break;case"console-debug":console.debug.apply(console,JSON.parse(t.content));break;case"console-info":console.info.apply(console,JSON.parse(t.content));break;case"console-warn":console.warn.apply(console,JSON.parse(t.content));break;case"console-error":console.error.apply(console,JSON.parse(t.content));break;case"stderr":console.error(t.content);break;case"window":window[t.method]();break;case"canvas":switch(t.op){case"getContext":s.ctx=s.canvas.getContext(t.type,t.attributes);break;case"resize":s.resize(t.width,t.height);break;case"renderCanvas":s.lastRenderTime<t.time&&(s.lastRenderTime=t.time,s.renderFramesData=t,window.requestAnimationFrame(w));break;case"renderFastCanvas":s.lastRenderTime<t.time&&(s.lastRenderTime=t.time,s.renderFramesData=t,window.requestAnimationFrame(b));break;case"setObjectProperty":s.canvas[t.object][t.property]=t.value;break;case"oneshot-result":if(t.iteration!=s.oneshotState.iteration)return void console.debug("received stale prerender, ignoring");s.debug&&console.info("oneshot received (start="+t.eventStart+", empty="+t.emptyFinish+"), render: "+Math.round(t.spentTime)+" ms"),s.oneshotState.renderRequested=!1,Math.abs(t.lastRenderedTime-s.oneshotState.requestNextTimestamp)<r&&(s.oneshotState.requestNextTimestamp=-1),t.eventStart-t.lastRenderedTime>r&&s.renderedItems.push({eventStart:t.lastRenderedTime,eventFinish:t.lastRenderedTime-.001,emptyFinish:t.eventStart,viewport:t.viewport,spentTime:0,blendTime:0,items:[],animated:!1,size:0});for(var n=[],a=0,o=0,i=t.canvases.length;o<i;o++){var d=t.canvases[o];n.push({w:d.w,h:d.h,x:d.x,y:d.y,image:new ImageData(new Uint8ClampedArray(d.buffer),d.w,d.h)}),a+=d.buffer.byteLength}var v=!1;if(t.emptyFinish>0&&t.emptyFinish-t.eventStart<1/s.targetFps||t.animated){var c=t.eventStart+1/s.targetFps;t.emptyFinish=c,t.eventFinish=c,v=!0}s.renderedItems.push({eventStart:t.eventStart,eventFinish:t.eventFinish,emptyFinish:t.emptyFinish,spentTime:t.spentTime,blendTime:t.blendTime,viewport:t.viewport,items:n,animated:t.animated,size:a}),s.renderedItems.sort((function(e,t){return e.eventStart-t.eventStart})),s.oneshotState.requestNextTimestamp>=0?f(s.oneshotState.requestNextTimestamp,!0):t.eventStart<0?console.info('oneshot received "end of frames" event'):t.emptyFinish>=0?f(t.emptyFinish,v):console.info("there are no more events to prerender");break;default:throw"eh?"}break;case"tick":s.frameId=t.id,s.worker.postMessage({target:"tock",id:s.frameId});break;case"custom":if(!s.onCustomMessage)throw"Custom message received but client onCustomMessage not implemented.";s.onCustomMessage(e);break;case"setimmediate":s.worker.postMessage({target:"setimmediate"});break;case"get-events":case"get-styles":case"ready":break;default:throw"what? "+t.target}},s.resize=function(e,t,r,o){var i=null;if(r=r||0,o=o||0,(!e||!t)&&s.video){var d=function(e,t){var r=s.prescaleFactor<=0?1:s.prescaleFactor;if(t<=0||e<=0)e=0,t=0;else{var n=r<1?-1:1,a=t;n*a*r<=n*s.prescaleHeightLimit?a*=r:n*a<n*s.prescaleHeightLimit&&(a=s.prescaleHeightLimit),s.maxRenderHeight>0&&a>s.maxRenderHeight&&(a=s.maxRenderHeight),e*=a/t,t=a}return{width:e,height:t}}((i=s.getVideoPosition()).width*s.pixelRatio,i.height*s.pixelRatio);e=d.width,t=d.height;var v=s.canvasParent.getBoundingClientRect().top-s.video.getBoundingClientRect().top;r=i.y-v,o=i.x}e&&t?(null!=i&&(s.canvasParent.style.position="relative",s.canvas.style.display="block",s.canvas.style.position="absolute",s.canvas.style.width=i.width+"px",s.canvas.style.height=i.height+"px",s.canvas.style.top=r+"px",s.canvas.style.left=o+"px",s.canvas.style.pointerEvents="none"),n===e&&a===t||(s.canvas.width=e,s.canvas.height=t,n=e,a=t,s.worker.postMessage({target:"canvas",width:s.canvas.width,height:s.canvas.height}),s.resetRenderAheadCache(!0))):s.video||console.error("width or height is 0. You should specify width & height for resize.")},s.resizeWithTimeout=function(){s.resize(),setTimeout(s.resize,100)},s.runBenchmark=function(){s.worker.postMessage({target:"runBenchmark"})},s.customMessage=function(e,t){t=t||{},s.worker.postMessage({target:"custom",userData:e,preMain:t.preMain})},s.setCurrentTime=function(e){s.worker.postMessage({target:"video",currentTime:e})},s.setTrackByUrl=function(e){s.worker.postMessage({target:"set-track-by-url",url:e}),s.resetRenderAheadCache(!1)},s.setTrack=function(e){s.worker.postMessage({target:"set-track",content:e}),s.resetRenderAheadCache(!1)},s.freeTrack=function(e){s.worker.postMessage({target:"free-track"}),s.resetRenderAheadCache(!1)},s.render=s.setCurrentTime,s.setIsPaused=function(e,t){s.worker.postMessage({target:"video",isPaused:e,currentTime:t})},s.setRate=function(e){s.worker.postMessage({target:"video",rate:e})},s.dispose=function(){s.worker.postMessage({target:"destroy"}),s.worker.terminate(),s.worker.removeEventListener("message",s.onWorkerMessage),s.worker.removeEventListener("error",s.workerError),s.workerActive=!1,s.worker=null,s.video&&(s.video.removeEventListener("timeupdate",o,!1),s.video.removeEventListener("playing",i,!1),s.video.removeEventListener("pause",d,!1),s.video.removeEventListener("seeking",v,!1),s.video.removeEventListener("seeked",c,!1),s.video.removeEventListener("ratechange",m,!1),s.video.removeEventListener("waiting",h,!1),s.video.removeEventListener("loadedmetadata",l,!1),document.removeEventListener("fullscreenchange",s.resizeWithTimeout,!1),document.removeEventListener("mozfullscreenchange",s.resizeWithTimeout,!1),document.removeEventListener("webkitfullscreenchange",s.resizeWithTimeout,!1),document.removeEventListener("msfullscreenchange",s.resizeWithTimeout,!1),window.removeEventListener("resize",s.resizeWithTimeout,!1),s.video.parentNode.removeChild(s.canvasParent),s.video=null),window.cancelAnimationFrame(s.rafId),s.rafId=0,s.ro&&(s.ro.disconnect(),s.ro=null),s.onCustomMessage=null,s.onErrorEvent=null,s.onReadyEvent=null},s.fetchFromWorker=function(e,t,r){try{var n=e.target,a=setTimeout((function(){i(Error("Error: Timeout while try to fetch "+n))}),5e3),o=function(e){e.data.target==n&&(t(e.data),s.worker.removeEventListener("message",o),s.worker.removeEventListener("error",i),clearTimeout(a))},i=function(e){r(e),s.worker.removeEventListener("message",o),s.worker.removeEventListener("error",i),clearTimeout(a)};s.worker.addEventListener("message",o),s.worker.addEventListener("error",i),s.worker.postMessage(e)}catch(e){r(e)}},s.createEvent=function(e){s.worker.postMessage({target:"create-event",event:e})},s.getEvents=function(e,t){s.fetchFromWorker({target:"get-events"},(function(t){e(t.events)}),t)},s.setEvent=function(e,t){s.worker.postMessage({target:"set-event",event:e,index:t})},s.removeEvent=function(e){s.worker.postMessage({target:"remove-event",index:e})},s.createStyle=function(e){s.worker.postMessage({target:"create-style",style:e})},s.getStyles=function(e,t){s.fetchFromWorker({target:"get-styles"},(function(t){e(t.styles)}),t)},s.setStyle=function(e,t){s.worker.postMessage({target:"set-style",style:e,index:t})},s.removeStyle=function(e){s.worker.postMessage({target:"remove-style",index:e})},s.init()})}}]);